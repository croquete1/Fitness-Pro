# Relatório de adopção do tema Neo

## Visão geral

Executámos `npm run neo:audit` para mapear utilitários ainda baseados em Tailwind/MUI e marcadores de funcionalidades por concluir. O script percorre `src/` inteiro e sinaliza linhas com `className` contendo tokens utilitários, imports de `@mui/*` e TODOs/mocks que impedem a adopção completa do tema `.neo`. 【F:scripts/neo-theme-audit.mjs†L1-L196】

## Componentes que ainda usam Tailwind utilitário

- Revisar o backoffice de onboarding avançado continua prioritário: alguns grids históricos (`src/components/admin/OnboardingTimeline.tsx`) ainda usam `flex` utilitário e `space-x-*` herdado.

## Dependências ainda baseadas em MUI

- O módulo de perfil (`src/components/profile/ProfileForm.tsx`) continua a importar `Box`, `Paper`, `Stack` e `TextField` de `@mui/material`, aguardando migração para campos `.neo-input`. 【F:src/components/profile/ProfileForm.tsx†L1-L165】
- As métricas históricas (`src/components/profile/MetricsTable.tsx`, `src/components/profile/MetricsChart.tsx`) dependem de tabelas/cartões `@mui/material`, pelo que permanecem fora do tema `.neo`. 【F:src/components/profile/MetricsTable.tsx†L1-L144】【F:src/components/profile/MetricsChart.tsx†L1-L120】

## Funcionalidades com dados mock ou TODOs

- As rotas críticas de perfil de cliente (`/api/users/[id]/notes|packages|anthropometry|sessions|plans`) foram ligadas ao Supabase com validação de permissões, eliminando o `_memdb` em memória. 【F:src/app/api/users/[id]/notes/route.ts†L1-L112】【F:src/app/api/users/[id]/packages/route.ts†L1-L87】【F:src/app/api/users/[id]/anthropometry/route.ts†L1-L146】【F:src/app/api/users/[id]/sessions/route.ts†L1-L141】【F:src/app/api/users/[id]/plans/route.ts†L1-L55】
- Continuam por migrar módulos administrativos que usam dados simulados ou caches locais, com destaque para a timeline legacy de onboarding e o histórico de planos.

## Gargalos de performance percebida

- `TrainerScheduleClient` acumula 200+ linhas de lógica cliente, fetch manual e renderização de listas sem memoização/virtualização, contribuindo para a sensação de UI "pesada". 【F:src/app/(app)/dashboard/pt/schedule/TrainerScheduleClient.tsx†L1-L284】
- O exportador CSV/print gera HTML inline e abre `window.open`, bloqueando o thread principal durante filtros longos. 【F:src/app/(app)/dashboard/pt/schedule/TrainerScheduleClient.tsx†L229-L360】

## Actualizações e vulnerabilidades pendentes

- `npm outdated` aponta versões atrás em `next@15.5.4`, `react@18.3.1` (já existe 19.x), `jspdf`/`jspdf-autotable` e todo o stack `@mui`, reforçando a dívida técnica da camada antiga. 【c9f047†L1-L22】
- `npm audit` reporta 3 vulnerabilidades (1 moderada, 2 altas) devido ao `dompurify` legado trazido por `jspdf` e `jspdf-autotable`. Actualizar estes pacotes para ≥3.0.3/5.0.2 elimina o risco. 【b8ffa6†L1-L15】

## Progresso recente

- O dashboard de auditoria administrativa (`/dashboard/admin/audit-log`) foi reconstruído com painéis `.neo`, métricas hero alimentadas pela nova rota `/api/admin/audit-log/dashboard`, linha temporal segmentada, distribuições por tipo/actor e tabela acessível com filtros declarativos, mantendo exportação CSV, badge `DataSourceBadge` e fallback determinístico documentado em `src/lib/fallback/admin-audit-log.ts`. 【F:src/app/(app)/dashboard/admin/audit-log/AuditLogClient.tsx†L1-L347】【F:src/app/api/admin/audit-log/dashboard/route.ts†L1-L68】【F:src/app/api/admin/audit-log/route.ts†L1-L284】【F:src/lib/fallback/admin-audit-log.ts†L1-L210】【F:src/app/globals.css†L7710-L7804】
- A agenda administrativa dos PTs (`/dashboard/admin/pts-schedule`) foi reconstruída em `.neo`, com meta-bar `DataSourceBadge`, métricas hero, painel de estados, destaques por treinador, filtros segmentados, exportação CSV e modais de criação/duplicação ligados ao novo agregador `/api/admin/pts-schedule/dashboard`, ao fallback determinístico e ao formulário partilhado `SessionForm`. 【F:src/app/(app)/dashboard/admin/pts-schedule/AdminPtsScheduleClient.tsx†L132-L470】【F:src/lib/admin/pts-schedule/dashboard.ts†L1-L200】【F:src/lib/fallback/admin-pts-schedule.ts†L1-L93】【F:src/app/api/admin/pts-schedule/dashboard/route.ts†L1-L33】【F:src/app/api/admin/pts-schedule/route.ts†L35-L139】【F:src/components/sessions/SessionForm.tsx†L1-L260】【F:src/app/globals.css†L14326-L14372】
- O módulo de remarcações do PT (`/dashboard/pt/reschedules`) passou para o tema `.neo`, com meta-bar `DataSourceBadge`, cartões hero, insights automáticos, listas acessíveis e diálogos consistentes alimentados pela nova rota `/api/pt/reschedules/dashboard`, agregadores tipados em `src/lib/trainer/reschedules/*` e fallback determinístico em `src/lib/fallback/trainer-reschedules.ts`. 【F:src/app/(app)/dashboard/pt/reschedules/TrainerReschedulesClient.tsx†L1-L496】【F:src/app/api/pt/reschedules/dashboard/route.ts†L1-L27】【F:src/lib/trainer/reschedules/server.ts†L1-L109】【F:src/lib/trainer/reschedules/dashboard.ts†L1-L237】【F:src/lib/fallback/trainer-reschedules.ts†L1-L152】【F:src/app/globals.css†L13426-L13557】

- O formulário de onboarding do cliente e a revisão administrativa foram reconstruídos com painéis `.neo`, resumo de progresso em tempo real, badges `DataSourceBadge`, notas filtráveis e composer acessível, eliminando `@mui/material` e consolidando estilos em `globals.css`. 【F:src/components/onboarding/ClientOnboardingFormClient.tsx†L1-L266】【F:src/app/(app)/dashboard/onboarding/page.tsx†L1-L20】【F:src/components/onboarding/AdminOnboardingReviewClient.tsx†L1-L280】【F:src/app/(app)/dashboard/admin/onboarding/[id]/page.tsx†L1-L48】【F:src/app/globals.css†L13157-L13246】
- Modernizámos o cabeçalho global com o novo hook `useNotificationItems`, popover `.neo` com métricas, botão "Marcar tudo" e `DataSourceBadge`, removendo os módulos MUI legados e fornecendo fallback determinístico quando o Supabase falha. 【F:src/components/layout/AppHeader.tsx†L1-L280】【F:src/components/header/useNotificationItems.ts†L1-L154】【F:src/lib/fallback/header-notifications.ts†L1-L63】【F:src/app/globals.css†L10883-L11268】
- Recriámos o centro e a lista de notificações do utilizador com painéis `.neo`, contagens Supabase/fallback e badges `DataSourceBadge`, actualizando a rota `/api/notifications/list` para expor a origem dos dados e os totais filtrados e enriquecendo o fallback determinístico com contagens coerentes. 【F:src/components/notifications/NotificationsCenterClient.tsx†L1-L272】【F:src/components/notifications/NotificationsListClient.tsx†L1-L232】【F:src/app/api/notifications/list/route.ts†L1-L132】【F:src/lib/fallback/notifications.ts†L1-L213】【F:src/app/globals.css†L13695-L13911】
- Migrámos o módulo "Sessões por PT (próx. 7 dias)" para um painel `.neo` server-side com badge de origem, resumo operativo, tabela acessível e fallback realista, substituindo `@mui/material`. 【F:src/app/(app)/dashboard/admin/_parts/AdminWeekTable.tsx†L1-L149】【F:src/lib/fallback/admin-week-sessions.ts†L1-L44】【F:src/app/globals.css†L1238-L1296】
- Refinámos o dashboard de mensagens (`/dashboard/messages`) com uma meta-bar `.neo` que destaca a origem dos dados, intervalo monitorizado e pendentes em tempo real, cartões hero com ícones contextuais, pesquisa com ícone embutido e acções consistentes de refresh/marcar tudo como lido com toasts, mantendo a ligação Supabase/fallback determinística e estilos partilhados em `globals.css`. 【F:src/app/(app)/dashboard/messages/MessagesDashboardClient.tsx†L1-L520】【F:src/app/(app)/dashboard/messages/parts/MarkAllRead.tsx†L1-L42】【F:src/app/globals.css†L10384-L10532】
- Criámos o componente partilhado `DataSourceBadge` para sinalizar a origem das métricas (`Supabase` ou fallback determinístico) e aplicámo-lo no painel do cliente e nos novos dashboards administrativos, expondo também o timestamp relativo da geração dos dados. 【F:src/components/ui/DataSourceBadge.tsx†L1-L45】【F:src/app/(app)/dashboard/DashboardClient.tsx†L16-L83】【F:src/app/(app)/dashboard/admin/approvals/ApprovalsClient.tsx†L771-L785】【F:src/app/(app)/dashboard/admin/notifications/NotificationsClient.tsx†L855-L873】
- O dashboard administrativo de aprovações foi reconstruído com painéis `.neo`, métricas hero, linha temporal, distribuição de estados, backlog e estatísticas de revisores, sustentado por novas rotas/serviços que agregam dados reais do Supabase e fallback determinístico. 【F:src/app/(app)/dashboard/admin/approvals/ApprovalsClient.tsx†L1-L744】【F:src/lib/admin/approvals/dashboard.ts†L1-L520】【F:src/app/api/admin/approvals/dashboard/route.ts†L1-L49】【F:src/lib/fallback/admin-approvals.ts†L1-L208】
- O centro administrativo de notificações passou a usar o tema `.neo`, com métricas hero, linha temporal, distribuição por canal/tipo e secções de campanhas/backlog, suportado por API dedicada e fallback realista para cenários offline. 【F:src/app/(app)/dashboard/admin/notifications/NotificationsClient.tsx†L1-L914】【F:src/lib/admin/notifications/dashboard.ts†L1-L520】【F:src/app/api/admin/notifications/dashboard/route.ts†L1-L49】【F:src/lib/fallback/admin-notifications.ts†L1-L190】
- O fluxo de autenticação (login, registo e recuperação) foi migrado para uma experiência `.neo`, com o novo `AuthNeoShell`/`AuthNeoInsights` (`src/components/auth/AuthNeoShell.tsx`, `src/components/auth/AuthNeoInsights.tsx`) a expor métricas em tempo real servidas pela rota pública `/api/public/landing` (`src/app/api/public/landing/route.ts`) e pelo agregador Supabase `src/lib/public/landing/dashboard.ts`, mantendo fallback determinístico em `src/lib/fallback/auth-landing.ts`. As páginas `src/app/login/LoginClient.tsx`, `src/app/register/RegisterClient.tsx`, `src/app/login/reset/ResetClient.tsx` e `src/app/login/forgot/page.tsx` partilham agora este layout e os novos tokens definidos em `src/app/globals.css`.
- A pesquisa do cabeçalho (`src/components/header/HeaderSearch.tsx`) deixou de usar `@mui/material`, adoptando popover `.neo`, badges de origem Supabase/fallback e carregamento acessível com o novo bloco de estilos em `src/app/globals.css`.
- O cartão de tarefas pessoais (`src/components/dashboard/TaskListCard.tsx`) foi reescrito com painéis `.neo`, persistência versionada no `localStorage` e métricas de progresso alimentadas pelos estilos `dashboard-taskList` definidos em `src/app/globals.css`.
- O painel principal do cliente (`src/app/(app)/dashboard/DashboardClient.tsx`) foi refinado com badges `.neo` que indicam a origem Supabase/fallback, toolbar de intervalo baseada em `Button`, skeletons responsivos e secções reorganizadas; a tabela de próximas sessões (`src/app/(app)/dashboard/clients/_parts/ClientUpcomingTable.tsx`) agora resolve nomes reais de PT, apresenta horários relativos e recorre ao fallback determinístico partilhado quando o Supabase não está disponível, suportado pelos novos estilos em `src/app/globals.css`.
- Os editores de planos e pacotes (`src/components/plan/PlanEditor.tsx`, `src/components/packages/PackageEditor.tsx`) foram reescritos em `.neo`, com combobox acessível, métricas em tempo real e painéis responsivos alimentados pelo Supabase, eliminando Tailwind utilitário.
- A agenda semanal do PT (`src/app/(app)/dashboard/pt/sessions/page.tsx`) e o painel de ordenação (`src/app/(app)/dashboard/pt/sessions/order/page.tsx`) abandonaram `@mui/material`, passando a usar tabelas `.neo`, diálogos acessíveis e listas ordenáveis reutilizáveis (`src/components/plan/OrderListDnD.tsx`, `src/components/plan/SessionOrderPanel.tsx`).
- As definições de folgas do PT (`src/app/(app)/dashboard/pt/settings/folgas/page.tsx`, `src/app/(app)/dashboard/pt/settings/folgas/FolgaForm.tsx`, `src/app/(app)/dashboard/pt/settings/folgas/EditFolgaButton.tsx`) foram reconstruídas no tema `.neo`, com métricas em tempo real, calendário interactivo e diálogo de edição alimentados pelo Supabase, eliminando utilitários Tailwind.
- O painel de mensagens do cliente (`src/app/(app)/dashboard/messages/**/*`) foi totalmente reconstruído como dashboard analítico `.neo`, com cartões hero, gráfico temporal, distribuição por canal, destaques automáticos e linha temporal interactiva alimentados por dados reais via `/api/messages/dashboard` (com fallback determinístico em `src/lib/fallback/messages.ts`).
- O painel principal do cliente (`src/app/(app)/dashboard/DashboardClient.tsx`) foi migrado para o tema `.neo`, com métricas hero, gráfico temporal, destaques, sessões, carteira, notificações e recomendações alimentadas pela nova rota `/api/client/dashboard/route.ts` e pelo pipeline em `src/lib/client/dashboard/*` (com fallback realista em `src/lib/fallback/client-dashboard.ts`).
- O fluxo de onboarding administrativo (`src/app/(app)/dashboard/admin/onboarding/AdminOnboardingListClient.tsx`) abandonou MUI/DataGrid em favor do design system `.neo`, com métricas reais do Supabase, filtros declarativos e tabela acessível sem utilitários legados.
- O atalho móvel (`src/components/common/MobileFAB.tsx`) ganhou estilos dedicados `.neo-fab`, com menu translúcido e botão temático responsivo.
- O cabeçalho do treinador (`src/components/trainer/TrainerHeader.tsx`) foi reconstruído com o padrão `neo-app-header`, substituindo gradients Tailwind por tokens do tema e avatar com contorno Neo.
- A agenda de PT (`src/app/(app)/dashboard/pt/schedule/TrainerScheduleClient.tsx`) recebeu uma revisão estrutural: filtros, métricas e tabela agora usam novos utilitários `.neo`, botões declarativos (`data-variant`) e feedbacks (`neo-spinner`, `neo-table-empty`).
- O painel de relatórios operacionais (`src/app/(app)/dashboard/reports/ReportsDashboardClient.tsx`) foi novamente reconstruído sobre estruturas `.neo`, agora com filtros colados, cartões de métricas temáticos, exportação CSV declarativa e secções de receita/sessões/avaliações alimentadas por dados reais do Supabase sem utilitários Tailwind.
- O histórico de sessões (`src/app/(app)/dashboard/history/SessionHistoryClient.tsx` + `page.tsx`) foi reimaginado no tema `.neo`, com filtros avançados, métricas em tempo real do Supabase, exportação CSV e listagens enriquecidas com nomes de clientes e PTs.
- O centro de operações administrativo (`src/app/(app)/dashboard/admin/AdminDashboardClient.tsx`) passou a usar apenas padrões `.neo`, com métricas, agenda e listagens reconstruídas sem utilitários Tailwind e botões alinhados aos `data-variant` do tema.
- Os cartões auxiliares do painel admin (`src/components/admin/MotivationAdminCard.tsx`, `src/components/admin/AdminQuickNotesCard.tsx`) foram actualizados para layouts `.neo`, abandonando `flex` utilitário e classes de espaçamento.
- A rota `/api/stats` liga-se agora ao Supabase para gerar contagens reais (utilizadores recentes, pacotes activos, sessões futuras e notas) e devolve tons temáticos em vez de classes Tailwind. 【F:src/app/api/stats/route.ts†L1-L75】
- O perfil detalhado do cliente (`src/app/(app)/dashboard/users/[id]/profile.client.tsx`) foi reescrito sem MUI, adoptando cards, métricas e formulários `.neo` com estados acessíveis e botões partilhados.
- Implementámos tabelas reais no Supabase para pacotes e notas de clientes (`supabase/migrations/20250328_add_client_notes_and_packages.sql`), permitindo que o front-end consuma dados vivos e remova mocks legados.
- A escala administrativa de treinadores (`src/app/(app)/dashboard/admin/roster/RosterClient.tsx`) adoptou os padrões `.neo`, ligando-se às novas tabelas `trainer_roster_assignments`/`trainer_roster_events` no Supabase e expondo filtros, métricas e cronologia com dados reais.
- A gestão de aprovações (`src/app/(app)/dashboard/admin/approvals/ApprovalsClient.tsx`) agora utiliza apenas estruturas `.neo`, com métricas temáticas, filtros declarativos e tabela padronizada; o backend continua a integrar com Supabase e fornece fallback informativo quando não configurado.
- O centro de notificações do utilizador (`src/app/(app)/dashboard/notifications/NotificationsClient.tsx`) foi reimaginado no tema `.neo`, com métricas reais do Supabase, distribuição temporal, filtros por tipo e fallback demonstrativo quando o backend está offline.
- O módulo de métricas do cliente (`src/app/(app)/dashboard/clients/metrics/**/*`) foi reconstruído no tema `.neo`, com cartões dinâmicos, gráfico interactivo, filtros de período e sincronização em tempo real com o Supabase (incluindo fallback documentado e dataset de referência).
- O painel de sessões do cliente (`src/app/(app)/dashboard/sessions/SessionsClient.tsx`) foi redesenhado com cartões `.neo`, timeline de presença, ranking de PT e gestão de pedidos alimentados por dados reais do Supabase (com fallback dinâmico quando a API não responde).
- O painel de planos do cliente (`src/app/(app)/dashboard/plans/PlansClient.tsx` + `/page.tsx`) foi convertido para a experiência `.neo`, combinando métricas reais do Supabase, insights automáticos, gráfico de atualizações e tabela filtrável com fallback documentado.
- O overview pessoal de planos (`src/app/(app)/dashboard/my-plan/MyPlanClient.tsx`, `/page.tsx` e `/api/client/plans/overview/route.ts`) foi reconstruído como dashboard `.neo`, com métricas hero, agenda exportável, destaques dinâmicos e tabela filtrável suportados pelo pipeline `src/lib/client/plans/overview/*`, fallback determinístico em `src/lib/fallback/client-plan-overview.ts` e sincronização com o Supabase.
- O detalhe de cada plano (`src/app/(app)/dashboard/my-plan/[id]/client.tsx` + `/page.tsx`) adoptou o tema `.neo`, trazendo métricas hero contextuais, selector de dias segmentado, editor de séries e alertas offline alimentados por `src/lib/client/plans/detail/*` e seeds em `src/lib/fallback/client-plan-detail.ts`.
- O painel de planos do treinador (`src/app/(app)/dashboard/pt/my-plan/PTPlansClient.tsx` + `/page.tsx`) passou para o tema `.neo`, trazendo métricas hero, timeline semanal, destaques operacionais e tabela filtrável alimentados por dados reais via `/api/pt/plans/dashboard` (com fallback determinístico em `src/lib/fallback/trainer-plans.ts`).
- A agenda de treinos do PT (`src/app/(app)/dashboard/pt/workouts/PTWorkoutsClient.tsx` + `/page.tsx`) foi reconstruída como dashboard analítico `.neo`, com cartões hero, distribuição de presenças, highlights e tabela filtrável apoiados pela nova rota `/api/pt/workouts/dashboard` e utilitários `src/lib/trainer/workouts/*` (com dataset determinístico em `src/lib/fallback/trainer-workouts.ts`).
- A biblioteca de exercícios do treinador (`src/app/(app)/dashboard/pt/library/PTLibraryClient.tsx`, `/api/pt/library/dashboard/route.ts`, `src/lib/trainer/library/*` e `src/lib/fallback/trainer-library.ts`) foi migrada para `.neo`, agora com métricas hero, gráfico temporal, distribuição por dificuldade, destaques accionáveis e tabela filtrável alimentadas por dados reais do Supabase com fallback determinístico.
- A biblioteca rápida de exercícios e o resumo diário do PT (`src/app/(app)/dashboard/pt/exercises/page.tsx`, `PTExercisesClient.tsx`, `PTExerciseNote.tsx`, `src/app/(app)/dashboard/pt/ui/PTLiveSummaryClient.tsx` e `src/app/(app)/dashboard/pt/sessions/ui/WeekCalendar.tsx`) foram actualizados para o tema `.neo`, trazendo métricas hero, filtros responsivos, notas persistentes com botões Neo e calendário semanal acessível; os estilos partilhados vivem agora em `src/app/globals.css` e existe fallback realista em `src/lib/fallback/pt-exercises.ts` quando o Supabase falha.
- O painel principal do treinador (`src/app/(app)/dashboard/trainer/**/*`, `/api/trainer/dashboard/route.ts`) foi migrado para `.neo` com cartões hero, gráfico temporal, agenda semanal, destaques operacionais, lista de pedidos e carteira de clientes suportados por Supabase através de `src/lib/trainer/dashboard/*` e fallback determinístico em `src/lib/fallback/trainer-dashboard.ts`.
- O módulo de faturação do cliente (`src/app/(app)/dashboard/billing/BillingClient.tsx` + `/page.tsx`) recebeu a meta-bar `DataSourceBadge`, cartões hero animados, alertas de vencidos e filtros segmentados `.neo`, mantendo timeline analítica e tabela exportável apoiadas pela API `/api/billing/dashboard` e pelo fallback determinístico. 【F:src/app/(app)/dashboard/billing/BillingClient.tsx†L1-L364】【F:src/app/globals.css†L7399-L7549】
- A carteira do cliente (`src/app/(app)/dashboard/clients/wallet/ClientWalletClient.tsx` + `/page.tsx`) foi reconstruída como dashboard `.neo`, com cartões hero, gráfico temporal, destaques dinâmicos, filtros e exportação CSV suportados pela API `/api/client/wallet/dashboard` e pelo pipeline `src/lib/client/wallet/*` com fallback determinístico em `src/lib/fallback/client-wallet.ts`.
- Criámos a migração `supabase/migrations/20250416_add_billing_invoices.sql`, introduzindo a tabela `billing_invoices`, índices e seeds para suportar as métricas de faturação sem depender de mocks.
- A administração de utilizadores (`src/app/(app)/dashboard/admin/users/users.client.tsx`) foi novamente reescrita no tema `.neo`, com resumo operacional em tempo real, distribuição por perfil/estado, lista paginada acessível e acções declarativas (exportar CSV, copiar emails, refresh) alimentadas por dados reais da API `/api/admin/users` e do agregador `/api/admin/users/dashboard`, mantendo fallback determinístico.
- O painel administrativo de planos (`src/app/(app)/dashboard/admin/plans/PlansClient.tsx`, `/page.tsx`, `/api/admin/plans/route.ts`, `/api/admin/plans/insights/route.ts`) passou para o tema `.neo`, com métricas hero em tempo real, distribuição por dificuldade, exportação/print acessíveis, undo optimista e tabela filtrável alimentada por Supabase com fallback determinístico em `src/lib/fallback/admin-plans.ts`.
- O fluxo de criação/edição de planos (`src/app/(app)/dashboard/admin/plans/PlanFormClient.tsx`, `PlanExercisesEditor.tsx`, `/new/page.tsx`, `/[id]/page.tsx`) foi reconstruído no tema `.neo`, com formulários acessíveis, validação inline, métricas contextuais, filtros responsivos e gestão de exercícios com dados reais do Supabase e fallback informativo.
- Os formulários de criação/edição (`src/app/(app)/dashboard/admin/users/UserFormClient.tsx`, `src/app/(app)/dashboard/admin/users/[id]/page.tsx`, `src/app/(app)/dashboard/admin/users/new/page.tsx`) abandonaram `@mui/material`, adoptaram campos `.neo-input-group`, controlos de aprovação/atividade e feedback inline com o novo CSS partilhado em `src/app/globals.css`.
- O motor de pesquisa global (`src/app/(app)/dashboard/search/**/*` e `/api/search`) foi reconstruído sobre componentes `.neo`, com cartões hero, timeline analítica, insights accionáveis e listagens filtráveis alimentadas por dados reais do Supabase via `src/lib/search/server.ts`/`dashboard.ts`, com fallback determinístico em `src/lib/fallback/search.ts`.
- Acrescentámos o script `supabase/migrations/20250404_add_trainer_roster.sql` para suportar a escala de PTs, vistas `admin_trainer_roster(*)` e políticas de serviço, removendo dependências de mocks nesse fluxo.
- A infraestrutura de notificações ganhou a migração `supabase/migrations/20250408_add_notifications.sql`, que define tabela, índices, triggers e políticas RLS para dados reais; os tipos foram sincronizados em `src/types/supabase.ts`.
- O painel de métricas operacionais (`src/app/(app)/dashboard/system/metrics/SystemMetricsClient.tsx`, `/page.tsx`, `/api/system/metrics/route.ts`, `src/lib/system/{dashboard,server,types}.ts` e `src/lib/fallback/system.ts`) foi reconstruído como dashboard `.neo` com cartões hero, gráfico temporal, distribuição e actividade alimentados por Supabase com fallback determinístico.
- O painel de logs do sistema (`src/app/(app)/dashboard/system/logs/**/*`, `/api/system/logs/dashboard`) foi migrado para o tema `.neo`, trazendo métricas hero, linha temporal segmentada, distribuição por categoria e tabela detalhada com dados reais via `src/lib/system/logs/*` (com fallback determinístico em `src/lib/fallback/system-logs.ts`).
- O formulário de perfil legado (`src/components/profile/ProfileForm.tsx`) e os módulos de métricas (`src/components/profile/MetricsChart.tsx`, `src/components/profile/MetricsTable.tsx`) foram reescritos para o tema `.neo`, com campos normalizados, estados acessíveis, alertas inline e gráfico sparkline responsivo alimentado por dados reais.
- As páginas operacionais de planos de PT (`src/app/(app)/dashboard/pt/plans/page.tsx`, `src/app/(app)/dashboard/pt/plans/[planId]/**/*`) abandonaram `@mui/material` e passaram a usar painéis `.neo`, listas acessíveis e acções declarativas, preservando drag-and-drop, ordenação e ligações aos dados Supabase em tempo real.
- As páginas de agendamento do PT (`src/app/(app)/dashboard/pt/sessions/new/page.tsx` e `src/app/(app)/dashboard/pt/sessions/[id]/page.tsx`) foram reconstruídas com painéis `.neo`, formulários acessíveis, métricas operacionais reais, `DataSourceBadge` e fallback determinístico (`src/lib/fallback/trainer-clients.ts`, `src/lib/fallback/sessions.ts`), eliminando `@mui/material` e alinhando as APIs com a agenda do Supabase.
- Criámos a migração `supabase/migrations/20250410_add_system_observability.sql`, que introduz `system_services`, `system_maintenance_windows` e `system_insights` com seeds, índices, triggers e políticas RLS; os tipos foram sincronizados em `src/types/supabase.ts`.
- Introduzimos a migração `supabase/migrations/20250417_add_audit_log.sql`, que cria a tabela `audit_log`, políticas RLS, triggers automáticas de login/logout e seeds iniciais para alimentar o dashboard de auditoria.
- As definições pessoais (`src/app/(app)/dashboard/settings/**/*`, `/api/settings/dashboard/route.ts`) foram reconstruídas como experiência `.neo`, com métricas hero, gráfico temporal, destaques e cartas de segurança alimentadas por Supabase via `src/lib/settings/{server,dashboard,types}.ts` e fallback determinístico em `src/lib/fallback/settings.ts`.
- A biblioteca de exercícios administrativa (`src/app/(app)/dashboard/admin/exercises/**/*`, `/api/admin/exercises/dashboard`, `src/lib/admin/exercises/*`, `src/lib/fallback/admin-exercises.ts`) foi reescrita no tema `.neo`, com cartões hero, gráfico temporal, distribuições por dificuldade/músculo/equipamento e tabela de gestão alimentada por dados reais do Supabase com fallback determinístico.
- O catálogo administrativo (`src/app/(app)/dashboard/admin/catalog/**/*`, `/api/admin/catalog/dashboard/route.ts`) foi migrado para o tema `.neo`, apresentando métricas hero, filtros segmentados, gráfico temporal e tabela exportável ligados ao Supabase (com refresh em tempo real e fallbacks partilhados com `src/lib/admin/exercises/*`).
- O painel administrativo de clientes (`src/app/(app)/dashboard/admin/clients/**/*`, `/api/admin/clients/dashboard`, `src/lib/admin/clients/*`, `src/lib/fallback/admin-clients.ts`) foi migrado para `.neo`, passando a expor métricas hero, gráfico temporal, distribuições de estado/carteira/engajamento, destaques accionáveis e tabela filtrável alimentados por dados reais do Supabase com fallback determinístico.
- O painel de saúde operacional (`src/app/(app)/dashboard/system/health/SystemHealthClient.tsx`, `/api/system/health/route.ts`, `src/lib/system/health/*`, `src/lib/fallback/system-health.ts`) passou a consumir métricas reais via API dedicada com fallback determinístico, cartões hero `.neo` e acções de refresh acessíveis. 【F:src/app/(app)/dashboard/system/health/SystemHealthClient.tsx†L1-L264】【F:src/app/api/system/health/route.ts†L1-L14】【F:src/lib/system/health/server.ts†L1-L78】【F:src/lib/fallback/system-health.ts†L1-L66】
- Introduzimos a migração `supabase/migrations/20250412_add_system_health_and_dashboard_chart.sql`, que adiciona `system_monitors`, `system_resilience_practices`, amplia `system_services` com `trend_label` e cria `dashboard_chart_points` com seeds e políticas. 【F:supabase/migrations/20250412_add_system_health_and_dashboard_chart.sql†L1-L136】
- A rota `/api/dashboard/cart` agora consulta `dashboard_chart_points` para devolver séries reais, mantendo fallback quando o Supabase não está disponível. 【F:src/app/api/dashboard/cart/route.ts†L1-L43】
- O perfil do utilizador (`src/app/(app)/dashboard/profile/**/*`, `/api/profile/dashboard`, `src/lib/profile/*`) foi reconstruído com o tema `.neo`, métricas hero, gráfico temporal, destaques dinâmicos e formulários acessíveis suportados por dados reais do Supabase e fallback determinístico. 【F:src/app/(app)/dashboard/profile/ProfileClient.tsx†L1-L497】【F:src/lib/profile/server.ts†L1-L214】【F:src/app/api/profile/dashboard/route.ts†L1-L24】【F:src/lib/fallback/profile.ts†L1-L73】

## Próximos passos recomendados

1. Priorizar a migração dos componentes administrativos restantes para padrões `.neo-*`, substituindo utilitários Tailwind por tokens declarativos.
2. Reescrever os módulos de perfil actualmente em MUI para componentes `.neo-form`, `.neo-card` e hooks partilhados.
3. Ligar as rotas com TODOs ao Supabase (quando necessário, fornecerei scripts SQL completos antes de aplicar mudanças) e remover `_memdb`.
4. Evoluir a agenda do PT para listas virtuais quando o volume de dados exceder 200 linhas, aproveitando a base `.neo` já aplicada.
5. Planear sprint específico para actualizar `jspdf`/`jspdf-autotable` (remediação das vulnerabilidades) e alinhar Next/React à versão suportada pelo tema.
